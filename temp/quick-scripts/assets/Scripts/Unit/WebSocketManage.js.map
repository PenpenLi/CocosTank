{"version":3,"sources":["WebSocketManage.ts"],"names":[],"mappings":";;;;;AAAA,iDAAuC;AACjC,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAE5C;IAA6C,mCAAY;IADzD;QAAA,qEAoDC;QAjDG,WAAW;QACH,mBAAa,GAAG,IAAI,uBAAQ,EAAE,CAAC;;IAgD3C,CAAC;IA9CG,+BAAK,GAAL;QACI,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,oEAAoE;QACpE,IAAI,CAAC,EAAE,GAAG,IAAI,SAAS,CAAC,2CAA2C,CAAC,CAAC;QACrE,IAAI,CAAC,EAAE,CAAC,MAAM,GAAG,UAAU,KAAK;YAC5B,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAC1B,CAAC,CAAA;QACD,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG,UAAU,KAAK;YAC7B,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAC3B,CAAC,CAAC;QACF,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG,UAAU,KAAK;YAC7B,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACzB,CAAC,CAAC;QACF,SAAS;QACT,IAAI,CAAC,EAAE,CAAC,SAAS,GAAG,UAAU,KAAK;YAC/B,mDAAmD;YACnD,kCAAkC;YAClC,8BAA8B;YAC9B,IAAI;YACJ,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;YACrC,IAAG,QAAQ,CAAC,WAAW,KAAK,IAAI,EAAE;gBAC9B,IAAI,CAAC,aAAa,CAAC,0BAA0B,CAAC,QAAQ,CAAC,CAAC;aAC3D;YACD,OAAO;YACP,IAAG,QAAQ,CAAC,WAAW,KAAK,GAAG,EAAE;gBAC7B,IAAI,CAAC,aAAa,CAAC,0BAA0B,CAAC,QAAQ,CAAC,CAAC;aAC3D;YACD,OAAO;YACP,IAAG,QAAQ,CAAC,WAAW,KAAK,GAAG,EAAE;gBAC7B,IAAI,CAAC,aAAa,CAAC,uBAAuB,CAAC,QAAQ,CAAC,CAAC;aACxD;YACD,OAAO;YACP,IAAG,QAAQ,CAAC,WAAW,KAAK,GAAG,EAAE;gBAC7B,IAAI,CAAC,aAAa,CAAC,8BAA8B,CAAC,QAAQ,CAAC,CAAC;aAC/D;YACD,IAAG,QAAQ,CAAC,WAAW,KAAK,GAAG,EAAE;gBAC7B,IAAI,CAAC,aAAa,CAAC,0BAA0B,CAAC,QAAQ,CAAC,CAAC;aAC3D;QACL,CAAC,CAAC;IAEN,CAAC;IACM,qCAAW,GAAlB,UAAmB,WAAW;QAC1B,IAAI,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;QAC1C,MAAM;QACN,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAC1B,CAAC;IAlDgB,eAAe;QADnC,OAAO;OACa,eAAe,CAmDnC;IAAD,sBAAC;CAnDD,AAmDC,CAnD4C,EAAE,CAAC,SAAS,GAmDxD;kBAnDoB,eAAe","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Unit","sourcesContent":["import Transfer from './TransferClass';\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class WebSocketManage extends cc.Component {\r\n    public ws: WebSocket;\r\n    // 事件处理中转对象\r\n    private TransferClass = new Transfer();\r\n\r\n    start() {\r\n        let self = this;\r\n        // this.ws = new WebSocket(\"ws://172.17.0.13:8080/tankWar/echo.do\");\r\n        this.ws = new WebSocket(\"ws://app.ei-marketing.net/tankWar/echo.do\");\r\n        this.ws.onopen = function (event) {\r\n            console.log(\"服务器已打开\");\r\n        }\r\n        this.ws.onerror = function (event) {\r\n            console.log(\"连接服务器失败\");\r\n        };\r\n        this.ws.onclose = function (event) {\r\n            console.log(\"服务器关闭\");\r\n        };\r\n        // 监听消息接收\r\n        this.ws.onmessage = function (event) {\r\n            // console.log('接受消息，当前执行回调函数=>', self.callbackObj)\r\n            // if (self.callbackObj != null) {\r\n            //     self.callbackObj(event)\r\n            // }\r\n            var response = JSON.parse(event.data)\r\n            if(response.dataMessage === '-1') {\r\n                self.TransferClass.getUserDataForHomePageCtrl(response);\r\n            }\r\n            // 生成地图\r\n            if(response.dataMessage === '0') {\r\n                self.TransferClass.generateMapForHomePageCtrl(response);\r\n            }\r\n            // 传输地图\r\n            if(response.dataMessage === '1') {\r\n                self.TransferClass.getMapForBattlePageCtrl(response);\r\n            }\r\n            // 位置联机\r\n            if(response.dataMessage === '2') {\r\n                self.TransferClass.positionUnicomForOperationCtrl(response);\r\n            }\r\n            if(response.dataMessage === '3') {\r\n                self.TransferClass.fireButtleForOperationCtrl(response);\r\n            }   \r\n        };\r\n\r\n    }\r\n    public sendMessage(JSONmessage) {\r\n        let message = JSON.stringify(JSONmessage);\r\n        //发送消息\r\n        this.ws.send(message);\r\n    }\r\n}\r\n"]}