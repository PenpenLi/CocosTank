{"version":3,"sources":["WebSocketManage.ts"],"names":[],"mappings":";;;;;AAAA,kDAA4C;AAC5C,6DAAuD;AACvD,oDAA8C;AAC9C,oDAA8C;AACxC,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAE5C;IAA6C,mCAAY;IADzD;QAAA,qEAiEC;QA3DW,gBAAU,GAAY,IAAI,CAAC;QAC3B,eAAS,GAAY,IAAI,CAAC;QAC1B,cAAQ,GAAY,IAAI,CAAC;QACzB,kBAAY,GAAW,IAAI,CAAC;;IAwDxC,CAAC;IAvDG,+BAAK,GAAL;QACI,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,EAAE,GAAG,IAAI,SAAS,CAAC,uCAAuC,CAAC,CAAC;QACjE,wEAAwE;QACxE,IAAI,CAAC,EAAE,CAAC,MAAM,GAAG,UAAU,KAAK;YAC5B,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAC1B,CAAC,CAAA;QACD,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG,UAAU,KAAK;YAC7B,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAC3B,CAAC,CAAC;QACF,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG,UAAU,KAAK;YAC7B,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACzB,CAAC,CAAC;QACF,SAAS;QACT,IAAI,CAAC,EAAE,CAAC,SAAS,GAAG,UAAU,KAAK;YAC/B,mDAAmD;YACnD,kCAAkC;YAClC,8BAA8B;YAC9B,IAAI;YACJ,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;YACrC,EAAE,CAAA,CAAC,QAAQ,CAAC,WAAW,KAAK,IAAI,CAAC,CAAC,CAAC;gBAC/B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;gBAChD,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YACnE,CAAC;YACD,OAAO;YACP,EAAE,CAAA,CAAC,QAAQ,CAAC,WAAW,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC9B,uDAAuD;gBACvD,+DAA+D;gBAC/D,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;gBAChD,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,aAAa,GAAG,QAAQ,CAAC,SAAS,CAAC;gBAC5E,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;gBACxD,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YACzE,CAAC;YACD,OAAO;YACP,EAAE,CAAA,CAAC,QAAQ,CAAC,WAAW,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC9B,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAA;gBACnD,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,qBAAU,CAAC,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAA;YACvE,CAAC;YACD,OAAO;YACP,EAAE,CAAA,CAAC,QAAQ,CAAC,WAAW,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC9B,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAA;gBACtE,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,6BAAmB,CAAC,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;YACpF,CAAC;YACD,EAAE,CAAA,CAAC,QAAQ,CAAC,WAAW,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC9B,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAA;gBACtE,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,6BAAmB,CAAC,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;YACrF,CAAC;QACL,CAAC,CAAC;IAEN,CAAC;IACM,qCAAW,GAAlB,UAAmB,WAAW;QAC1B,IAAI,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;QAC1C,MAAM;QACN,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAC1B,CAAC;IA/DgB,eAAe;QADnC,OAAO;OACa,eAAe,CAgEnC;IAAD,sBAAC;CAhED,AAgEC,CAhE4C,EAAE,CAAC,SAAS,GAgExD;kBAhEoB,eAAe","file":"","sourceRoot":"../../../../assets/Scripts","sourcesContent":["import BattleCtrl from './Page/BattleCatrl';\r\nimport PlayerOperationCtrl from './PlayerOperationCtrl'\r\nimport HomePageCtrl from './Page/HomePageCtrl'\r\nimport MatchingCtrl from './Page/MatchingCtrl'\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class WebSocketManage extends cc.Component {\r\n    public ws: WebSocket;\r\n    public callbackObj: any;\r\n    public funName: string;\r\n\r\n    private BattlePage: cc.Node = null;\r\n    private Operation: cc.Node = null;\r\n    private HomePage: cc.Node = null;\r\n    private MatchingPage: cc.Node =null;\r\n    start() {\r\n        let self = this;\r\n        this.ws = new WebSocket(\"ws://172.17.0.13:8080/tankWar/echo.do\");\r\n        // this.ws = new WebSocket(\"ws://app.ei-marketing.net/tankWar/echo.do\");\r\n        this.ws.onopen = function (event) {\r\n            console.log(\"服务器已打开\");\r\n        }\r\n        this.ws.onerror = function (event) {\r\n            console.log(\"连接服务器失败\");\r\n        };\r\n        this.ws.onclose = function (event) {\r\n            console.log(\"服务器关闭\");\r\n        };\r\n        // 监听消息接收\r\n        this.ws.onmessage = function (event) {\r\n            // console.log('接受消息，当前执行回调函数=>', self.callbackObj)\r\n            // if (self.callbackObj != null) {\r\n            //     self.callbackObj(event)\r\n            // }\r\n            var response = JSON.parse(event.data)\r\n            if(response.dataMessage === '-1') {\r\n                self.HomePage = cc.find('Canvas/HomePagePanel');\r\n                self.HomePage.getComponent(HomePageCtrl).getUserData(response);\r\n            }\r\n            // 生成地图\r\n            if(response.dataMessage === '0') {\r\n                // self.BattlePage = cc.find('Canvas/BattlePagePanel');\r\n                // self.BattlePage.getComponent(BattleCtrl).sendCallBackFor0();\r\n                self.HomePage = cc.find('Canvas/HomePagePanel');\r\n                self.HomePage.getComponent(HomePageCtrl).enemyUserData = response.enemyData;\r\n                self.MatchingPage = cc.find('Canvas/MatchingPagePanel');\r\n                self.MatchingPage.getComponent(MatchingCtrl).setBattelData(response);\r\n            }\r\n            // 传输地图\r\n            if(response.dataMessage === '1') {\r\n                self.BattlePage = cc.find('Canvas/BattlePagePanel')\r\n                self.BattlePage.getComponent(BattleCtrl).sendCallBackFor1(response)\r\n            }\r\n            // 位置联机\r\n            if(response.dataMessage === '2') {\r\n                self.Operation = cc.find('Canvas/BattlePagePanel/BattleBox/operation')\r\n                self.Operation.getComponent(PlayerOperationCtrl).setOtherTankDataFor2(response);\r\n            }\r\n            if(response.dataMessage === '3') {\r\n                self.Operation = cc.find('Canvas/BattlePagePanel/BattleBox/operation')\r\n                self.Operation.getComponent(PlayerOperationCtrl).generateReceiveButtle(response);\r\n            }   \r\n        };\r\n\r\n    }\r\n    public sendMessage(JSONmessage) {\r\n        let message = JSON.stringify(JSONmessage);\r\n        //发送消息\r\n        this.ws.send(message);\r\n    }\r\n}\r\n"]}