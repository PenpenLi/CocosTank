{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Unit/assets\\Scripts\\Unit\\WebSocketManage.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Unit","sourcesContent":["import Transfer from './TransferClass';\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class WebSocketManage extends cc.Component {\r\n    public ws: WebSocket;\r\n    // 事件处理中转对象\r\n    private TransferClass = new Transfer();\r\n    private websocketUrl = 'ws://172.17.0.13:8080/tankWar/echo.do';\r\n    // private websocketUrl = 'ws://app.ei-marketing.net/tankWar/echo.do';\r\n    start() {\r\n        this.init();\r\n    }\r\n    init() {\r\n        let self = this;\r\n        this.ws = new WebSocket(this.websocketUrl);\r\n        // this.ws = new WebSocket(\"ws://app.i-mineral.cn/tankWar/echo.do\");\r\n        this.ws.onopen = function (event) {\r\n            console.log(\"服务器已打开\");\r\n        }\r\n        this.ws.onerror = function (event) {\r\n            console.log(\"连接服务器失败\", event);\r\n        };\r\n        this.ws.onclose = function (event) {\r\n            console.log(\"服务器已断开!\", event);\r\n            self.init();\r\n        };\r\n        // 监听消息接收\r\n        this.ws.onmessage = function (event) {\r\n            // console.log('接受消息，当前执行回调函数=>', self.callbackObj)\r\n            // if (self.callbackObj != null) {\r\n            //     self.callbackObj(event)\r\n            // }\r\n            var response = JSON.parse(event.data)\r\n            if(response.dataMessage === '-1') {\r\n                self.TransferClass.getUserDataForHomePageCtrl(response);\r\n            }\r\n            // 生成地图\r\n            if(response.dataMessage === '0') {\r\n                self.TransferClass.generateMapForHomePageCtrl(response);\r\n            }\r\n            // 传输地图\r\n            if(response.dataMessage === '1') {\r\n                console.log('接收地图')\r\n                self.TransferClass.getMapForBattlePageCtrl(response);\r\n            }\r\n            // 位置联机\r\n            if(response.dataMessage === '2') {\r\n                self.TransferClass.positionUnicomForOperationCtrl(response);\r\n            }\r\n            // 子弹\r\n            // if(response.dataMessage === '3') {\r\n            //     self.TransferClass.fireButtleForOperationCtrl(response);\r\n            // }\r\n            // 死亡\r\n            if(response.dataMessage === '4') {\r\n                self.TransferClass.dieForTankCtrl(response);\r\n            }\r\n            // 重新开始\r\n            if(response.dataMessage === '5') {\r\n                self.TransferClass.restartForBattleCtrl(response);\r\n            }\r\n            // 对方离开房间\r\n            if(response.dataMessage === '6') {\r\n                console.log('对方离开房间!')\r\n                self.TransferClass.leaveForBattleCtrl(response);\r\n            }\r\n            // 收到道具生成信息\r\n            if(response.dataMessage === '7') {\r\n                self.TransferClass.genteraPropsForBattleCtrl(response);\r\n            }\r\n            if(response.dataMessage === '8') {\r\n                self.TransferClass.getRoomNumberForFriendCtrl(response);\r\n            }\r\n            if(response.dataMessage === '9') {\r\n                self.TransferClass.getFriendForHomePageCtrl(response);\r\n            }\r\n            if(response.dataMessage === '211') {\r\n                self.TransferClass.getOnClickStart();\r\n            }\r\n        };\r\n    }\r\n    public sendMessage(JSONmessage) {\r\n        let message = JSON.stringify(JSONmessage);\r\n        //发送消息\r\n        this.ws.send(message);\r\n    }\r\n}\r\n"]}