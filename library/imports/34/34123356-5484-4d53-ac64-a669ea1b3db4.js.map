{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Page/assets\\Scripts\\Page\\HomePageCtrl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Page","sourcesContent":["import WebSocketManage from '../Unit/WebSocketManage';\r\nimport FriendPageCtrl from '../Page/FriendPageCtrl';\r\nimport { AudioSource } from '../../creator';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewClass extends cc.Component {\r\n    @property(cc.Prefab)\r\n    lobbyPanel: cc.Prefab = null;\r\n    @property(cc.SpriteFrame)\r\n    openSoundSprite: cc.SpriteFrame = null;\r\n    @property(cc.SpriteFrame)\r\n    closeSoundSprite: cc.SpriteFrame = null;\r\n    @property(cc.AudioSource)\r\n    bgSound: AudioSource = null;\r\n    @property(cc.Prefab)\r\n    FriendPage: cc.Prefab = null;\r\n\r\n    public IsSound: boolean = true;//是否开启音效\r\n\r\n    public status = true;\r\n    @property(cc.Node)\r\n    private ping: cc.Node = null;\r\n    @property(cc.Node)\r\n    private WebScoketNode: cc.Node = null;\r\n\r\n    public viceUserInfo = {\r\n        nickname: '',\r\n        headimgurl: ''\r\n    }\r\n    public userInfo = {\r\n        openid: '',\r\n        nickname: '',\r\n        headimgurl: ''\r\n    }\r\n    private WebSocket: WebSocketManage = null;\r\n\r\n    start() {\r\n        this.WebSocket = this.WebScoketNode.getComponent(WebSocketManage);\r\n        this.getPing();\r\n        this._onInit();\r\n    }\r\n    /**\r\n     * 初始化\r\n     */\r\n    private _onInit() {\r\n        var _self = this;\r\n        // 获取授权\r\n        wx.authorize({ scope: 'scope.userInfo' })\r\n        this.WebSocket.ws.onopen = function (event) {\r\n            _self.getUserOpenid();\r\n            wx.onShow((response) => {\r\n                if (response.query.room) {\r\n                    _self.isWxShare(response.query.room);\r\n                }\r\n            });\r\n            if (wx.getLaunchOptionsSync().query.room) {\r\n                _self.isWxShare(wx.getLaunchOptionsSync().query.room);\r\n            };\r\n        }\r\n\r\n    }\r\n    /**\r\n    * 通过小游戏转发进入游戏\r\n    * room: 房间号\r\n    * userInfo：当前玩家信息\r\n    */\r\n    private isWxShare(roomId) {\r\n        var _self = this;\r\n        wx.getUserInfo({\r\n            success: function (res) {\r\n                res = res.userInfo;\r\n                var userInfo = {\r\n                    nickname: res.nickName,\r\n                    headimgurl: res.avatarUrl,\r\n                    openid: ''\r\n                }\r\n                _self.userInfo = userInfo;\r\n                _self.WebSocket.sendMessage({\r\n                    msg: 6,\r\n                    houseid: roomId,\r\n                    userInfo: userInfo\r\n                })\r\n            }\r\n        })\r\n    }\r\n    /**\r\n     * 获取用户openid\r\n     */\r\n    private getUserOpenid() {\r\n        var _self = this;\r\n        wx.login({\r\n            success: function (res) {\r\n                var xhr = new XMLHttpRequest();\r\n                xhr.onreadystatechange = function () {\r\n                    if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                        var res = JSON.parse(xhr.responseText);\r\n                        _self.userInfo.openid = res.openid;\r\n                        _self.uploadUserInfo();\r\n                    }\r\n                }\r\n                xhr.open('GET', `http://app.ei-marketing.net/tankWar/acceputJSCODE.do?JSCODE=${res.code}`, true);\r\n                xhr.send();\r\n            }\r\n        })\r\n    }\r\n    /**\r\n     * 点击开始\r\n     */\r\n    private OnClickStartButton() {\r\n        if (!this.status) {\r\n            return;\r\n        }\r\n        this.status = !this.status;\r\n        var lobbyPanelPage = cc.instantiate(this.lobbyPanel);\r\n        lobbyPanelPage.parent = this.node.parent;\r\n        this.enabled = false;\r\n        // this.uploadUserInfo();\r\n        // this.WebSocket.sendMessage({msg: 1})\r\n    }\r\n    private uploadUserInfo() {\r\n        var _self = this;\r\n        wx.getSetting({\r\n            success: function (res) {\r\n                if (res.authSetting['scope.userInfo']) {\r\n                    wx.getUserInfo({\r\n                        success: function (res) {\r\n                            res = res.userInfo;\r\n                            console.log(res);\r\n                            _self.userInfo.nickname = res.nickName\r\n                            _self.userInfo.headimgurl = res.avatarUrl\r\n                            _self.WebSocket.sendMessage({\r\n                                msg: 'userInfo',\r\n                                data: {\r\n                                    openid: _self.userInfo.openid,\r\n                                    nickname: _self.userInfo.nickname,\r\n                                    headimgurl: _self.userInfo.headimgurl\r\n                                }\r\n                            })\r\n\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        })\r\n    }\r\n    /**\r\n     * 点击声音按钮\r\n     */\r\n    private OnClickSoundButton(event) {\r\n        this.IsSound = !this.IsSound;\r\n        var buttonSprite: cc.Sprite = event.target.getComponent(cc.Sprite);\r\n        this.IsSound ? (buttonSprite.spriteFrame = this.openSoundSprite, this.bgSound.resume()) : (buttonSprite.spriteFrame = this.closeSoundSprite, this.bgSound.pause())\r\n    }\r\n    /**\r\n     * 获取网络延迟信息\r\n     */\r\n    private getPing() {\r\n        var net_1 = cc.find('Canvas/Ping/net_1')\r\n        var net_2 = cc.find('Canvas/Ping/net_2')\r\n        var net_3 = cc.find('Canvas/Ping/net_3')\r\n        var pingNode = this.node.parent.getChildByName('Ping');\r\n        pingNode.zIndex = 9999;\r\n        var self = this;\r\n        setTimeout(() => {\r\n            self.getPing();\r\n        }, 1000)\r\n        var url = 'http://app.ei-marketing.net/tankWar/ping.do'\r\n        // var url = 'http://172.17.0.13:8080/tankWar/ping.do'\r\n        var xmlHttp;\r\n        var start = new Date().getTime();\r\n        xmlHttp = new XMLHttpRequest();\r\n        xmlHttp.onreadystatechange = state_Change;\r\n        xmlHttp.open('GET', url, true);\r\n        xmlHttp.send(null);\r\n        function state_Change() {\r\n            if (xmlHttp.readyState === 4) {\r\n                if (xmlHttp.status === 200) {\r\n                    var end = new Date().getTime();\r\n                    if((end - start) < 50) {\r\n                        net_1.active = true;\r\n                        net_2.active = false;\r\n                        net_3.active = false;\r\n                    } else if((end - start) < 100) {\r\n                        net_1.active = false;\r\n                        net_2.active = true;\r\n                        net_3.active = false;\r\n                    } else {\r\n                        net_1.active = false;\r\n                        net_2.active = false;\r\n                        net_3.active = true;\r\n                    }\r\n                    pingNode.getComponent(cc.Label).string = (end - start) + 'ms'\r\n                }\r\n            }\r\n        }\r\n    }\r\n    public getUserData(response) {\r\n        console.log('---')\r\n        this.userInfo = response.data;\r\n        var lobbyPanelPage = cc.instantiate(this.lobbyPanel);\r\n        lobbyPanelPage.parent = this.node.parent;\r\n        this.enabled = false;\r\n    }\r\n\r\n    public setViceUserInfoForFriend(nickname, headimgurl) {\r\n        this.viceUserInfo.nickname = nickname;\r\n        this.viceUserInfo.headimgurl = headimgurl;\r\n    }\r\n\r\n    public linkForFriend(res) {\r\n        this.viceUserInfo.nickname = res.data.nickname\r\n        this.viceUserInfo.headimgurl = res.data.headimgurl\r\n        var friendPage = cc.instantiate(this.FriendPage);\r\n        friendPage.parent = this.node.parent;\r\n        friendPage.getComponent(FriendPageCtrl).init(2);\r\n        this.enabled = false;\r\n    }\r\n}\r\n"]}